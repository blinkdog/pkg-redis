From: Chris Lamb <lamby@debian.org>
Date: Thu, 28 Jul 2016 08:06:33 -0400
Subject: Avoid world readable .rediscli_history (Closes: #832460)

Thanks to kpcyrd <kpcyrd@rxv.cc>.

Signed-off-by: Chris Lamb <lamby@debian.org>
---
 deps/linenoise/linenoise.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/deps/linenoise/linenoise.c b/deps/linenoise/linenoise.c
index a807d9b..889a225 100644
--- a/deps/linenoise/linenoise.c
+++ b/deps/linenoise/linenoise.c
@@ -111,6 +111,7 @@
 #include <string.h>
 #include <stdlib.h>
 #include <ctype.h>
+#include <sys/stat.h>
 #include <sys/types.h>
 #include <sys/ioctl.h>
 #include <unistd.h>
@@ -1160,10 +1161,14 @@ int linenoiseHistorySetMaxLen(int len) {
 /* Save the history in the specified file. On success 0 is returned
  * otherwise -1 is returned. */
 int linenoiseHistorySave(const char *filename) {
+    mode_t old_umask;
+    old_umask = umask(S_IXUSR|S_IRWXG|S_IRWXO);
     FILE *fp = fopen(filename,"w");
+    umask(old_umask);
     int j;
 
     if (fp == NULL) return -1;
+    chmod(filename,S_IRUSR|S_IWUSR);
     for (j = 0; j < history_len; j++)
         fprintf(fp,"%s\n",history[j]);
     fclose(fp);
